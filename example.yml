---
vars:
  .network_id: mitum contest; Sat 26 Dec 2020 05:29:13 AM KST
  .genesis.privatekey: L5GTSKkRs9NPsXwYgACZdodNUJqCAWjz2BccuR4cAgxJumEZWjokmpr
  .genesis.publickey: rcrd3KA2wWNhKdAP8rHRzfRmgp91oR9mqopckyXRmCvGmpu

designs:
  common: |
    address: {{ setgetVar ".self.address" ( printf "%ssas" .self.alias ) }}
    privatekey: {{ setgetVar ".self.privatekey" newKey }}
    network-id: {{ .network_id }}
    network:
      bind: 0.0.0.0:54321
      publish: {{ setgetVar ".self.network.publish" ( nodePublishAddr .self.alias "udp" "54321" ) }}
      tls-insecure: true

  genesis:
    - type: suffrage_genesis_join
      node: "{{ .nodes.no0.address }}"
      publickey: "{{ with .nodes.no0.privatekey }}{{ .publickey }}{{ end }}"
  
  number-nodes: 4

expects:
  - condition: |
      {"msg": "contest ready"}
    registers:
      - assign: ".findme.hehehe"
    actions:
      - type: "start-nodes"
        args: [no0]
        exit-code: 0

  - condition: |
      {"msg": "findme"}
    registers:
      - assign: ".findme.hihihi"
    actions:
      - type: "stop-nodes"
        args: [no0, no1]
        exit-code: 1
